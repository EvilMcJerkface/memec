#!/bin/bash

EXE_DIR=..
#coding=("raid5" "rdp" "cauchy" "rs" "evenodd")
coding=("evenodd")
k=("4" "6" "8" "12")
m=2
csizes=("2048" "4096" "8192" "16384" "32768" "65536" "131072")
## k=6
#csizes=("750" "1500" "3000" "6000" "9000" "12000" "24000" "48000" "96000" "192000")
#csizes=("500" "1000" "2000" "4000" "6000" "8000" "16000" "32000" "64000" "128000")
#csizes=("1000" "2000" "4000" "8000" "12000" "16000" "32000" "64000" "128000" "256000")
## k=4
#csizes=("500" "1000" "2000" "4000" "6000" "8000" "16000" "32000" "64000" "128000")
#csizes=("1000" "2000" "4000" "8000" "12000" "16000" "32000" "64000" "128000" "256000")
## k=8
#csizes=("1250" "2500" "5000" "10000" "15000" "20000" "40000" "80000" "160000" "320000")
#csizes=("500" "1000" "2000" "4000" "6000" "8000" "16000" "32000" "64000" "128000")
#csizes=("1000" "2000" "4000" "8000" "12000" "16000" "32000" "64000" "128000" "256000")
rounds=5000
OUT="./coding.perf.out"
#OUT="./${coding[0]}.${k[0]}.${m}.out"
#OUT="./${coding[0]}.4.chunk.out"

cd ${EXE_DIR}

sed -i "s/\(ROUNDS (\).*)/\1${rounds})/" performance.cc
echo "ROUNDS=${rounds}" | tee ${OUT}

for s in ${csizes[@]}; do
	sed -i "s/\(CHUNK_SIZE (\).*)/\1${s})/" performance.cc
	for i in ${k[@]}; do
		sed -i "s/\(C_K (\).*)/\1${i})/" performance.cc
		make
		for c in ${coding[@]}; do
			echo "======== ${s},${i},${c} ==========" | tee -a ${OUT}
			./performance ${c} 2>&1 | tee -a ${OUT}
			sleep 5
		done
	done
done
